!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e){t.exports=PIXI},function(t,e,s){"use strict";s.r(e);var i=s(0);let n=innerWidth/5,o=[50,80],l=(innerWidth-n)/o[1],a=innerHeight/o[0],r=Math.min(l,a),h=4*r,c=new i.Application({width:(o[1]-1)*r+n,height:(o[0]-1)*r});const u=.005,m=.005,d=2,f=1;class w{constructor(t,e,s,i){this.mass=t,this.max_mass=e,this.max_comp=s,this.flowable=i}}class p{constructor(t,e,s){this.up=t[e-1][s],this.down=t[e+1][s],this.right=t[e][s+1],this.left=t[e][s-1],this.center=t[e][s]}}function x(t,e,s){return t<=e?e:t<2*e+s?(e*e+t*s)/(e+s):.5*(t+s)}class g extends w{constructor(t=0,e=1,s=.1){super(t,e,s,!0)}color(){console.assert(this.mass>=0,"negative mass");let t=170*this.mass;return 0|(t=Math.min(t,255))}addmass(t){this.mass+=t}emptyCell(){return new g}copy(){let t=new g;return t.mass=this.mass,t.max_mass=this.max_mass,t.max_comp=this.max_comp,t.flowable=this.flowable,t}move(t,e,s){let i=this.mass;if(i<=u)return void(this.mass=0);let n=f*s,o=0;if(t.down.flowable&&((o=x(i+t.down.mass,this.max_mass,this.max_comp)-t.down.mass)>m&&(o*=n),o=Math.min(Math.max(o,0),Math.min(d,i)),e.center.mass-=o,e.down.mass+=o,i-=o),t.left.flowable){if(i<=0)return;(o=.25*(i-t.left.mass))>m&&(o*=n),o=Math.min(Math.max(o,0),i),e.center.mass-=o,e.left.mass+=o,i-=o}if(t.right.flowable){if(i<=0)return;(o=1/3*(i-t.right.mass))>m&&(o*=n),o=Math.min(Math.max(o,0),i),e.center.mass-=o,e.right.mass+=o,i-=o}if(t.up.flowable){if(i<=0)return;(o=i-x(i+t.up.mass,this.max_mass,this.max_comp))>m&&(o*=n),o=Math.min(Math.max(o,0),Math.min(d,i)),e.center.mass-=o,e.up.mass+=o}}}class v extends w{constructor(t=0,e=1,s=.1){super(t,e,s,!1)}color(){return 16777215}addmass(t){}emptyCell(){return new v}copy(){let t=new v;return t.mass=this.mass,t.max_mass=this.max_mass,t.max_comp=this.max_comp,t.flowable=this.flowable,t}move(t,e,s){e.center.mass=this.mass}}let M=new class{constructor(t,e){this.cells=new Array(t);for(let s=0;s<t;s++)this.cells[s]=new Array(e).fill(new g)}get(t){let e=t[0],s=t[1];return this.cells.length<=e||e<0?null:this.cells[0].length<=s||s<0?null:this.cells[t[0]][t[1]]}set(t,e){this.cells[t[0]][t[1]]=e}row(){return this.cells.length}col(){return this.cells[0].length}update(t){let e,s,i=this.row()-1,n=this.col()-1,o=new Array(this.row());for(let t=0;t<this.row();t++){o[t]=new Array(this.col());for(let e=0;e<this.col();e++)o[t][e]=this.cells[t][e].copy()}for(var l=1;l<i;++l)for(var a=1;a<n;++a)e=new p(this.cells,l,a),s=new p(o,l,a),this.cells[l][a].move(e,s,t);this.cells=o}}(o[0],o[1]);!function(){let t=new i.Container;c.stage.addChild(t);let e=new i.Text("add",{fontSize:20,fill:"white"});e.position.set(o[1]*r,100),t.addChild(e);let s=new i.Sprite(i.Texture.WHITE);s.interactive=!0,s.buttonMode=!0,s.width=h,s.height=h,s.tint=255,s.position.set(o[1]*r,0),c.stage.addChild(s);let n=new i.Text("Water",{fontSize:1.5*r,fill:"white"});n.position.set(s.position.x,s.position.y+h+10),c.stage.addChild(n);let l=new i.Sprite(i.Texture.WHITE);l.interactive=!0,l.buttonMode=!0,l.width=h,l.height=h,l.tint=16777215,l.position.set((o[1]+2)*r+h,0),c.stage.addChild(l);let a=new i.Text("Block",{fontSize:1.5*r,fill:"white"});a.position.set(l.position.x,l.position.y+h+10),c.stage.addChild(a);let u=new i.Sprite(i.Texture.WHITE);u.interactive=!0,u.buttonMode=!0,u.width=h,u.height=h,u.tint=10066329,u.position.set((o[1]+4)*r+2*h,0),c.stage.addChild(u);let m=new i.Text("Delete",{fontSize:1.5*r,fill:"white"});m.position.set(u.position.x,u.position.y+h+10),c.stage.addChild(m),(()=>{let e=!1,i=()=>{};s.on("mousedown",function(s){console.log(innerWidth,innerHeight),i=function(){let i;if(e){let e=s.data.getLocalPosition(t);for(var n=-1;n<=1;++n)for(var o=-1;o<=1;++o)null!=(i=M.get([Math.floor(e.y/r)+n,Math.floor(e.x/r)+o]))&&i.addmass(1)}}}),l.on("mousedown",function(s){console.log("hello"),i=function(){if(e){let e=s.data.getLocalPosition(t),i=Math.floor(e.y/r),n=Math.floor(e.x/r);null!=M.get([i,n])&&M.set([i,n],new v)}}}),u.on("mousedown",function(s){i=function(){if(e){let e=s.data.getLocalPosition(t);for(var i=-1;i<=1;++i)for(var n=-1;n<=1;++n){let t=Math.floor(e.y/r),s=Math.floor(e.x/r);null!=M.get([t,s])&&M.set([t,s],new g(0))}}}}),t.on("mousedown",function(t){e=!0}),t.on("mouseup",function(t){e=!1}),t.on("mousemove",function(t){i()})})();let d=new Array(o[0]);for(let e=0;e<o[0];e++){d[e]=new Array(o[1]);for(let s=0;s<o[1];s++)d[e][s]=new i.Sprite(i.Texture.WHITE),d[e][s].width=r,d[e][s].height=r,d[e][s].position.set(s*r,e*r),t.addChild(d[e][s])}t.interactive=!0,t.buttonMode=!0;let f=new i.Graphics;t.addChild(f);let w=0;c.ticker.add(function(t){w+=t,e.text=String(c.ticker.FPS),M.update(1),w>0&&(function(t,e){let s;for(var i=0;i<t.row();++i)for(var n=0;n<t.col();++n)null!=(s=t.get([i,n]))&&(e[i][n].tint=s.color())}(M,d),w=0)})}(),document.body.appendChild(c.view)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUElYSVwiIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJQSVhJIiwicmlnaHRXaW5kb3dXaWR0aCIsImlubmVyV2lkdGgiLCJzeXNzaXplIiwiZHgiLCJkeSIsImlubmVySGVpZ2h0IiwiZGVsdGEiLCJNYXRoIiwibWluIiwiYnV0dG9uU2l6ZSIsImFwcCIsInBpeGlfanNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsIndpZHRoIiwiaGVpZ2h0IiwibWluX21hc3MiLCJtaW5fZmxvdyIsIm1heF9mbG93IiwiZmxvd19zcGVlZCIsIkNlbGwiLCJbb2JqZWN0IE9iamVjdF0iLCJtYXNzIiwibWF4X21hc3MiLCJtYXhfY29tcCIsImZsb3dhYmxlIiwidGhpcyIsIk5OQ2VsbHMiLCJjZWxscyIsImoiLCJ1cCIsImRvd24iLCJyaWdodCIsImxlZnQiLCJjZW50ZXIiLCJnZXRfc3RhYmxlX3N0YXRlX2Rvd24iLCJ0b3RhbF9tYXNzIiwibWF4X2NvbXByZXNzaW9uIiwiV2F0ZXIiLCJzdXBlciIsImNvbnNvbGUiLCJhc3NlcnQiLCJiIiwidiIsInciLCJubiIsIndyaXRlX25uIiwicmVtYWluaW5nX21hc3MiLCJmbG93X3NwZWVkX2RlbHRhIiwiZmxvdyIsIm1heCIsIkdyb3VuZCIsImciLCJyb3ciLCJjb2wiLCJBcnJheSIsImZpbGwiLCJpaiIsImxlbmd0aCIsImllbmQiLCJqZW5kIiwibmV3X2NlbGxzIiwiY29weSIsIm1vdmUiLCJnYW1lU2NlbmUiLCJzdGFnZSIsImFkZENoaWxkIiwidGV4dCIsImZvbnRTaXplIiwicG9zaXRpb24iLCJzZXQiLCJiX2FkZCIsIldISVRFIiwiaW50ZXJhY3RpdmUiLCJidXR0b25Nb2RlIiwidGludCIsImJfYWRkX3RleHQiLCJ4IiwieSIsImJfYmxvY2siLCJiX2Jsb2NrX3RleHQiLCJiX2RlbGV0ZSIsImJfZGVsZXRlX3RleHQiLCJpc1RvdWNoZWQiLCJjbGlja19mdW5jIiwib24iLCJlIiwibG9nIiwiZGF0YSIsImdldExvY2FsUG9zaXRpb24iLCJmbG9vciIsImFkZG1hc3MiLCJldmVudCIsInNwcml0ZV9tYXQiLCJyZWN0IiwidGltZSIsInRpY2tlciIsImFkZCIsIlN0cmluZyIsIkZQUyIsInVwZGF0ZSIsImNvbG9yIiwiZHJhd19jZWxsc19zcHJpdGUiLCJzZXR1cCIsImRvY3VtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwidmlldyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixF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SUFBSXFELEVBQUksRUFBR0EsRUFBSUQsRUFBTTBCLFFBQVN6QixFQUV0QixPQURUaEQsRUFBSStDLEVBQU10QyxLQUFLZCxFQUFHcUQsT0FFZGdFLEVBQVdySCxHQUFHcUQsR0FBRzhDLEtBQU85RixFQUFFd0gsU0FnTzlCQyxDQUFrQjFFLEVBQU9pRSxHQUN6QkUsRUFBTyxLQVNuQlEsR0FLQUMsU0FBU0MsS0FBS0MsWUFBWTlGLEVBQUkrRiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBQSVhJOyIsImltcG9ydCAqIGFzIFBJWEkgZnJvbSAncGl4aS5qcyc7XG5cbi8vQ3JlYXRlIGEgUGl4aSBBcHBsaWNhdGlvblxuXG5sZXQgcmlnaHRXaW5kb3dXaWR0aCA9IGlubmVyV2lkdGggLyA1XG5cbmxldCBzeXNzaXplID0gWzUwLCA4MF1cbmxldCBkeCA9IChpbm5lcldpZHRoLXJpZ2h0V2luZG93V2lkdGgpIC8gc3lzc2l6ZVsxXVxubGV0IGR5ID0gaW5uZXJIZWlnaHQgLyBzeXNzaXplWzBdXG5cbmxldCBkZWx0YSA9IE1hdGgubWluKGR4LCBkeSlcblxubGV0IGJ1dHRvblNpemUgPSBkZWx0YSo0XG5cbmxldCBhcHAgPSBuZXcgUElYSS5BcHBsaWNhdGlvbih7d2lkdGg6IChzeXNzaXplWzFdLTEpKmRlbHRhICsgcmlnaHRXaW5kb3dXaWR0aCwgaGVpZ2h0OiAoc3lzc2l6ZVswXS0xKSpkZWx0YX0pO1xuXG5jb25zdCBtYXhfbWFzcyA9IDEuMFxuY29uc3QgbWluX21hc3MgPSAwLjAwNVxuY29uc3QgbWF4X2NvbXAgPSAwLjI1XG5cbmNvbnN0IG1pbl9mbG93ID0gMC4wMDVcbmNvbnN0IG1heF9mbG93ID0gMlxuY29uc3QgZmxvd19zcGVlZCA9IDFcblxuXG5hYnN0cmFjdCBjbGFzcyBDZWxsXG57XG4gICAgbWFzcyA6IG51bWJlclxuICAgIG1heF9tYXNzIDogbnVtYmVyXG4gICAgbWF4X2NvbXAgOiBudW1iZXJcbiAgICBmbG93YWJsZSA6IGJvb2xlYW5cbiAgICBjb25zdHJ1Y3RvcihtYXNzIDogbnVtYmVyLCBtYXhfbWFzcyA6IG51bWJlciwgbWF4X2NvbXAgOiBudW1iZXIsIGZsb3dhYmxlIDogYm9vbGVhbilcbiAgICB7XG4gICAgICAgIHRoaXMubWFzcyA9IG1hc3NcbiAgICAgICAgdGhpcy5tYXhfbWFzcyA9IG1heF9tYXNzXG4gICAgICAgIHRoaXMubWF4X2NvbXAgPSBtYXhfY29tcFxuICAgICAgICB0aGlzLmZsb3dhYmxlID0gZmxvd2FibGVcbiAgICB9XG4gICAgLy8gdHN1biBkZWhhIGFueSBqYW5haXRvIGRhbWVcbiAgICBhYnN0cmFjdCBtb3ZlKG5uIDogYW55LCB3cml0ZV9ubiA6IGFueSwgZGVsdGEgOiBudW1iZXIpIDogdm9pZFxuICAgIGFic3RyYWN0IGVtcHR5Q2VsbCgpIDogQ2VsbFxuICAgIGFic3RyYWN0IGNvcHkoKSA6IENlbGxcbiAgICBhYnN0cmFjdCBjb2xvcigpIDogbnVtYmVyXG4gICAgYWJzdHJhY3QgYWRkbWFzcyh2IDogbnVtYmVyKSA6IHZvaWRcbn1cblxuXG5jbGFzcyBOTkNlbGxzIHtcbiAgICB1cDogICAgQ2VsbFxuICAgIGRvd246ICBDZWxsXG4gICAgcmlnaHQ6IENlbGxcbiAgICBsZWZ0OiAgQ2VsbFxuICAgIGNlbnRlcjogQ2VsbFxuICAgIGNvbnN0cnVjdG9yKGNlbGxzOiBDZWxsW11bXSwgaTpudW1iZXIsIGo6bnVtYmVyKSBcbiAgICB7XG4gICAgICAgIHRoaXMudXAgPSBjZWxsc1tpLTFdW2pdXG4gICAgICAgIHRoaXMuZG93biA9IGNlbGxzW2krMV1bal1cbiAgICAgICAgdGhpcy5yaWdodCA9IGNlbGxzW2ldW2orMV1cbiAgICAgICAgdGhpcy5sZWZ0PSBjZWxsc1tpXVtqLTFdXG4gICAgICAgIHRoaXMuY2VudGVyID0gY2VsbHNbaV1bal1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdldF9zdGFibGVfc3RhdGVfZG93bih0b3RhbF9tYXNzOm51bWJlciwgbWF4X21hc3M6bnVtYmVyLCBtYXhfY29tcHJlc3Npb246bnVtYmVyKSA6IG51bWJlciB7XG4gICAgaWYgKHRvdGFsX21hc3MgPD0gbWF4X21hc3MpXG4gICAgICAgIHJldHVybiBtYXhfbWFzc1xuICAgIGVsc2UgaWYgKHRvdGFsX21hc3MgPCAyKm1heF9tYXNzICsgbWF4X2NvbXByZXNzaW9uKVxuICAgICAgICByZXR1cm4gKG1heF9tYXNzKm1heF9tYXNzICsgdG90YWxfbWFzcyptYXhfY29tcHJlc3Npb24gKSAvIChtYXhfbWFzcyArIG1heF9jb21wcmVzc2lvbilcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiAwLjUgKiAodG90YWxfbWFzcyArIG1heF9jb21wcmVzc2lvbilcbn1cblxuY2xhc3MgV2F0ZXIgZXh0ZW5kcyBDZWxsXG57XG4gICAgY29uc3RydWN0b3IgKG1hc3M6bnVtYmVyID0gMC4wICwgbWF4X21hc3M6bnVtYmVyPTEuMCwgbWF4X2NvbXA6bnVtYmVyPTAuMSlcbiAgICB7XG4gICAgICAgIHN1cGVyKG1hc3MsIG1heF9tYXNzLCBtYXhfY29tcCwgdHJ1ZSlcbiAgICB9XG4gICAgY29sb3IoKVxuICAgIHtcbiAgICAgICAgY29uc29sZS5hc3NlcnQodGhpcy5tYXNzID49IDAsIFwibmVnYXRpdmUgbWFzc1wiKVxuICAgICAgICBsZXQgYiA9IHRoaXMubWFzcyAqICgyNTUuMCAqIDIuMC8zLjApXG4gICAgICAgIGIgPSBNYXRoLm1pbihiLCAyNTUpXG4gICAgICAgIHJldHVybiAweDAwMDAwMCB8IGJcbiAgICB9XG5cbiAgICBhZGRtYXNzKHYgOiBudW1iZXIpXG4gICAge1xuICAgICAgICB0aGlzLm1hc3MgKz0gdlxuICAgIH1cblxuICAgIGVtcHR5Q2VsbCgpXG4gICAge1xuICAgICAgICByZXR1cm4gbmV3IFdhdGVyKClcbiAgICB9XG4gICAgY29weSgpIDogV2F0ZXJcbiAgICB7XG4gICAgICAgIGxldCB3ID0gbmV3IFdhdGVyKClcbiAgICAgICAgdy5tYXNzID0gdGhpcy5tYXNzXG4gICAgICAgIHcubWF4X21hc3MgPSB0aGlzLm1heF9tYXNzXG4gICAgICAgIHcubWF4X2NvbXAgPSB0aGlzLm1heF9jb21wXG4gICAgICAgIHcuZmxvd2FibGUgPSB0aGlzLmZsb3dhYmxlXG4gICAgICAgIHJldHVybiB3XG4gICAgfVxuXG4gICAgbW92ZSAobm4gOiBOTkNlbGxzLCB3cml0ZV9ubiA6IE5OQ2VsbHMsIGRlbHRhIDogbnVtYmVyKVxuICAgIHtcbiAgICAgICAgbGV0IHJlbWFpbmluZ19tYXNzID0gdGhpcy5tYXNzXG5cbiAgICAgICAgaWYgKHJlbWFpbmluZ19tYXNzIDw9IG1pbl9tYXNzKSB7XG4gICAgICAgICAgICB0aGlzLm1hc3MgPSAwLjBcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9IFxuXG4gICAgICAgIGxldCBmbG93X3NwZWVkX2RlbHRhID0gZmxvd19zcGVlZCAqIGRlbHRhXG5cbiAgICAgICAgLy8gZG93blxuICAgICAgICBsZXQgZmxvdyA9IDBcbiAgICAgICAgaWYgKG5uLmRvd24uZmxvd2FibGUpIHtcbiAgICAgICAgICAgIGZsb3cgPSBnZXRfc3RhYmxlX3N0YXRlX2Rvd24ocmVtYWluaW5nX21hc3MgKyBubi5kb3duLm1hc3MsIHRoaXMubWF4X21hc3MsIHRoaXMubWF4X2NvbXApIC0gbm4uZG93bi5tYXNzXG4gICAgICAgICAgICBpZiAoZmxvdyA+IG1pbl9mbG93KSB7XG4gICAgICAgICAgICAgICAgZmxvdyAqPSBmbG93X3NwZWVkX2RlbHRhXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmbG93ID0gTWF0aC5taW4oTWF0aC5tYXgoZmxvdywgMCksIE1hdGgubWluKG1heF9mbG93LCByZW1haW5pbmdfbWFzcykpXG4gICAgICAgICAgICB3cml0ZV9ubi5jZW50ZXIubWFzcyAtPSBmbG93XG4gICAgICAgICAgICB3cml0ZV9ubi5kb3duLm1hc3MgKz0gZmxvd1xuICAgICAgICAgICAgcmVtYWluaW5nX21hc3MgLT0gZmxvd1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbGVmdFxuICAgICAgICBpZiAobm4ubGVmdC5mbG93YWJsZSkge1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ19tYXNzIDw9IDAuMCkgcmV0dXJuXG4gICAgICAgICAgICBmbG93ID0gMS4wLzQuMCAqIChyZW1haW5pbmdfbWFzcyAtIG5uLmxlZnQubWFzcylcbiAgICAgICAgICAgIGlmIChmbG93ID4gbWluX2Zsb3cpXG4gICAgICAgICAgICAgICAgZmxvdyAqPSBmbG93X3NwZWVkX2RlbHRhXG4gICAgICAgICAgICBmbG93ID0gTWF0aC5taW4oTWF0aC5tYXgoZmxvdywgMCksIHJlbWFpbmluZ19tYXNzKVxuICAgICAgICAgICAgd3JpdGVfbm4uY2VudGVyLm1hc3MgLT0gZmxvd1xuICAgICAgICAgICAgd3JpdGVfbm4ubGVmdC5tYXNzICs9IGZsb3dcbiAgICAgICAgICAgIHJlbWFpbmluZ19tYXNzIC09IGZsb3dcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJpZ2h0XG4gICAgICAgIGlmIChubi5yaWdodC5mbG93YWJsZSkge1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ19tYXNzIDw9IDAuMCkgcmV0dXJuXG4gICAgICAgICAgICBmbG93ID0gMS4wLzMuMCAqIChyZW1haW5pbmdfbWFzcyAtIG5uLnJpZ2h0Lm1hc3MpXG4gICAgICAgICAgICBpZiAoZmxvdyA+IG1pbl9mbG93KVxuICAgICAgICAgICAgICAgIGZsb3cgKj0gZmxvd19zcGVlZF9kZWx0YVxuICAgICAgICAgICAgZmxvdyA9IE1hdGgubWluKE1hdGgubWF4KGZsb3csIDApLCByZW1haW5pbmdfbWFzcylcbiAgICAgICAgICAgIHdyaXRlX25uLmNlbnRlci5tYXNzIC09IGZsb3dcbiAgICAgICAgICAgIHdyaXRlX25uLnJpZ2h0Lm1hc3MgKz0gZmxvd1xuICAgICAgICAgICAgcmVtYWluaW5nX21hc3MgLT0gZmxvd1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBcbiAgICAgICAgaWYgKG5uLnVwLmZsb3dhYmxlKSB7XG4gICAgICAgICAgICBpZiAocmVtYWluaW5nX21hc3MgPD0gMC4wKSByZXR1cm5cbiAgICAgICAgICAgIC8vaWYgKHJlbWFpbmluZ19tYXNzID49IG5uLnVwLm1hc3MgKVxuICAgICAgICAgICAgLy8gICAgcmV0dXJuXG4gICAgICAgICAgICBmbG93ID0gcmVtYWluaW5nX21hc3MgLSBnZXRfc3RhYmxlX3N0YXRlX2Rvd24ocmVtYWluaW5nX21hc3Mrbm4udXAubWFzcywgdGhpcy5tYXhfbWFzcywgdGhpcy5tYXhfY29tcClcbiAgICAgICAgICAgIGlmIChmbG93ID4gbWluX2Zsb3cpIHtcbiAgICAgICAgICAgICAgICBmbG93ICo9IGZsb3dfc3BlZWRfZGVsdGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZsb3cgPSBNYXRoLm1pbihNYXRoLm1heChmbG93LCAwKSwgTWF0aC5taW4obWF4X2Zsb3csIHJlbWFpbmluZ19tYXNzKSlcblxuICAgICAgICAgICAgd3JpdGVfbm4uY2VudGVyLm1hc3MgLT0gZmxvd1xuICAgICAgICAgICAgd3JpdGVfbm4udXAubWFzcyArPSBmbG93XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIEdyb3VuZCBleHRlbmRzIENlbGxcbntcbiAgICBjb25zdHJ1Y3RvciAobWFzczpudW1iZXIgPSAwLjAgLCBtYXhfbWFzczpudW1iZXI9MS4wLCBtYXhfY29tcDpudW1iZXI9MC4xKVxuICAgIHtcbiAgICAgICAgc3VwZXIobWFzcywgbWF4X21hc3MsIG1heF9jb21wLCBmYWxzZSlcbiAgICB9XG4gICAgY29sb3IoKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIDB4RkZGRkZGXG4gICAgfVxuXG4gICAgYWRkbWFzcyh2IDogbnVtYmVyKVxuICAgIHtcbiAgICB9XG4gICAgXG4gICAgZW1wdHlDZWxsKClcbiAgICB7XG4gICAgICAgIHJldHVybiBuZXcgR3JvdW5kKClcbiAgICB9XG5cbiAgICBjb3B5KCkgOiBHcm91bmRcbiAgICB7XG4gICAgICAgIGxldCBnID0gbmV3IEdyb3VuZCgpXG4gICAgICAgIGcubWFzcyA9IHRoaXMubWFzc1xuICAgICAgICBnLm1heF9tYXNzID0gdGhpcy5tYXhfbWFzc1xuICAgICAgICBnLm1heF9jb21wID0gdGhpcy5tYXhfY29tcFxuICAgICAgICBnLmZsb3dhYmxlID0gdGhpcy5mbG93YWJsZVxuICAgICAgICByZXR1cm4gZ1xuICAgIH1cblxuICAgIG1vdmUobm4gOiBOTkNlbGxzLCB3cml0ZV9ubiA6IE5OQ2VsbHMsIGRlbHRhIDogbnVtYmVyKVxuICAgIHtcbiAgICAgICAgd3JpdGVfbm4uY2VudGVyLm1hc3MgPSB0aGlzLm1hc3NcbiAgICB9XG59XG5cbmNsYXNzIENlbGxzIHtcbiAgICBjZWxsczogQ2VsbFtdW11cbiAgICBjb25zdHJ1Y3Rvcihyb3c6IG51bWJlciwgY29sOiBudW1iZXIpIFxuICAgIHtcbiAgICAgICAgdGhpcy5jZWxscyA9IG5ldyBBcnJheShyb3cpXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTxyb3c7IGkrKylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5jZWxsc1tpXSA9IG5ldyBBcnJheShjb2wpLmZpbGwobmV3IFdhdGVyKCkpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQoaWo6W251bWJlciwgbnVtYmVyXSkgOiBDZWxsIHwgbnVsbFxuICAgIHtcbiAgICAgICAgbGV0IGkgPSBpalswXVxuICAgICAgICBsZXQgaiA9IGlqWzFdXG4gICAgICAgIGlmICh0aGlzLmNlbGxzLmxlbmd0aCA8PSBpIHx8IGkgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNlbGxzWzBdLmxlbmd0aCA8PSBqIHx8IGogPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNlbGxzW2lqWzBdXVtpalsxXV1cbiAgICB9XG5cbiAgICBzZXQoaWo6W251bWJlciwgbnVtYmVyXSwgYzpDZWxsKSA6IHZvaWRcbiAgICB7XG4gICAgICAgIHRoaXMuY2VsbHNbaWpbMF1dW2lqWzFdXSA9IGNcbiAgICB9XG5cbiAgICByb3coKSA6IG51bWJlciBcbiAgICB7cmV0dXJuIHRoaXMuY2VsbHMubGVuZ3RofVxuICAgIGNvbCgpIDogbnVtYmVyIFxuICAgIHtyZXR1cm4gdGhpcy5jZWxsc1swXS5sZW5ndGh9XG5cbiAgICB1cGRhdGUoZGVsdGEgOiBudW1iZXIpIDogdm9pZFxuICAgIHtcbiAgICAgICAgbGV0IGlzdGFydCA9IDFcbiAgICAgICAgbGV0IGllbmQgPSB0aGlzLnJvdygpLTFcbiAgICAgICAgbGV0IGpzdGFydCA9IDFcbiAgICAgICAgbGV0IGplbmQgPSB0aGlzLmNvbCgpLTFcbiAgICAgICAgbGV0IG5uXG4gICAgICAgIGxldCB3cml0ZV9ublxuICAgICAgICBsZXQgbmV3X2NlbGxzID0gbmV3IEFycmF5KHRoaXMucm93KCkpXG5cbiAgICAgICAgLy8gaW5pdCBuZXdfY2VsbHNcbiAgICAgICAgZm9yIChsZXQgaT0wOyBpPHRoaXMucm93KCk7IGkrKylcbiAgICAgICAge1xuICAgICAgICAgICAgbmV3X2NlbGxzW2ldID0gbmV3IEFycmF5KHRoaXMuY29sKCkpXG4gICAgICAgICAgICBmb3IgKGxldCBqPTA7IGo8dGhpcy5jb2woKTsgaisrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5ld19jZWxsc1tpXVtqXSA9IHRoaXMuY2VsbHNbaV1bal0uY29weSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gaXN0YXJ0OyBpIDwgaWVuZDsgKytpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0ganN0YXJ0OyBqIDwgamVuZDsgKytqKSB7XG4gICAgICAgICAgICAgICAgbm4gPSBuZXcgTk5DZWxscyh0aGlzLmNlbGxzLCBpLCBqKVxuICAgICAgICAgICAgICAgIHdyaXRlX25uID0gbmV3IE5OQ2VsbHMobmV3X2NlbGxzLCBpLCBqKVxuICAgICAgICAgICAgICAgIHRoaXMuY2VsbHNbaV1bal0ubW92ZShubiwgd3JpdGVfbm4sIGRlbHRhKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2VsbHMgPSBuZXdfY2VsbHNcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGRyYXdfY2VsbHNfc3ByaXRlKGNlbGxzIDogQ2VsbHMsIHNwcml0ZV9tYXQgOiBQSVhJLlNwcml0ZVtdW10pXG57XG4gICAgbGV0IGNcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNlbGxzLnJvdygpOyArK2kpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjZWxscy5jb2woKTsgKytqKSB7XG4gICAgICAgICAgICBjID0gY2VsbHMuZ2V0KFtpLCBqXSlcbiAgICAgICAgICAgIGlmIChjICE9IG51bGwpXG4gICAgICAgICAgICAgICAgc3ByaXRlX21hdFtpXVtqXS50aW50ID0gYy5jb2xvcigpXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIGZ1bmN0aW9uIHByaW50X2NlbGxfYXNjaWkoY2VsbHMgOiBDZWxscykge1xuLy8gICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2VsbHMucm93KCk7ICsraSkge1xuLy8gICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNlbGxzLmNvbCgpOyArK2opIHtcbi8vICAgICAgICAgICAgIGxldCB2ID0gY2VsbHMuZ2V0KFtpLCBqXSkubWFzc1xuLy8gICAgICAgICAgICAgbGV0IGMgPSBTdHJpbmcoTWF0aC5mbG9vcih2ICogMTApIC8gMTApXG4vLyAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcbi8vICAgICAgICAgICAgICAgICBTdHJpbmcoYykgKyBcIixcIlxuLy8gICAgICAgICAgICAgKVxuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiXCIpXG4vLyAgICAgfVxuLy8gfVxuXG4vLyAvLyBEZWJ1ZyAtLS0tLS1cbi8vIGxldCBjZWxscyA9IG5ldyBDZWxscyhzeXNzaXplWzBdLCBzeXNzaXplWzFdKVxuLy8gbGV0IHNwYWNlID0gNVxuLy8gbGV0IGhhbGYgPSBNYXRoLmZsb29yKHN5c3NpemVbMV0vMilcblxuLy8gY2VsbHMgPSBuZXcgQ2VsbHMoc3lzc2l6ZVswXSwgc3lzc2l6ZVsxXSlcbi8vIGZvciAodmFyIGkgPSAwOyBpIDwgc3lzc2l6ZVswXTsgKytpKSB7XG4vLyAgICAgY2VsbHMuc2V0KFtpLCAwXSwgbmV3IEdyb3VuZCg5KSlcbi8vICAgICBjZWxscy5zZXQoW2ksIHN5c3NpemVbMV1dLCBuZXcgR3JvdW5kKDkpKVxuLy8gfVxuLy8gZm9yICh2YXIgaSA9IDA7IGkgPCBzeXNzaXplWzBdLXNwYWNlOyArK2kpIHtcbi8vICAgICBjZWxscy5zZXQoW2ksIGhhbGZdLCBuZXcgR3JvdW5kKDkpKVxuLy8gfVxuLy8gZm9yICh2YXIgaiA9IDA7IGogPCBzeXNzaXplWzFdOyArK2opIHtcbi8vICAgICBjZWxscy5zZXQoW3N5c3NpemVbMF0tMSwgal0sIG5ldyBHcm91bmQoOSkpXG4vLyB9XG4vLyBjZWxscy5zZXQoW3N5c3NpemVbMF0tMiwgaGFsZl0sIG5ldyBXYXRlcigxKSlcbi8vIHByaW50X2NlbGxfYXNjaWkoY2VsbHMpXG5cbi8vIC8vIHNldCBXYXRlclxuLy8gZm9yICh2YXIgaiA9IDE7IGogPCBoYWxmOyArK2opIHtcbi8vICAgICBjZWxscy5zZXQoWzUsIGpdLCBuZXcgV2F0ZXIoMSkpXG4vLyAgICAgY2VsbHMuc2V0KFs0LCBqXSwgbmV3IFdhdGVyKDEpKVxuLy8gICAgIGNlbGxzLnNldChbMywgal0sIG5ldyBXYXRlcigxKSlcbi8vICAgICBjZWxscy5zZXQoWzIsIGpdLCBuZXcgV2F0ZXIoMSkpXG4vLyAgICAgY2VsbHMuc2V0KFsxLCBqXSwgbmV3IFdhdGVyKDEpKVxuLy8gfVxuLy8gY2VsbHMudXBkYXRlKDEpXG4vLyBjZWxscy51cGRhdGUoMSlcbi8vIGNlbGxzLnVwZGF0ZSgxKVxuLy8gY2VsbHMudXBkYXRlKDEpXG4vLyBjZWxscy51cGRhdGUoMSlcbi8vIHByaW50X2NlbGxfYXNjaWkoY2VsbHMpXG5cbi8vIGZvciAodmFyIGkgPSAwOyBpIDwgMTAwMDsgKytpKSB7XG4vLyAgICAgY2VsbHMudXBkYXRlKDEpXG4vLyB9XG4vLyBwcmludF9jZWxsX2FzY2lpKGNlbGxzKVxuXG4vLyBwcmludF9jZWxsX2FzY2lpKGNlbGxzKVxuXG5cbi8vIGxldCB1ID0gMC4wXG4vLyBsZXQgZCA9IDAuMzMzXG5cbi8vIC0tLS0tLS0tLS0tLVxuXG5sZXQgY2VsbHMgPSBuZXcgQ2VsbHMoc3lzc2l6ZVswXSwgc3lzc2l6ZVsxXSlcblxuXG5mdW5jdGlvbiBzZXR1cCgpIFxue1xuICAgIGxldCBnYW1lU2NlbmUgPSBuZXcgUElYSS5Db250YWluZXIoKVxuICAgIGFwcC5zdGFnZS5hZGRDaGlsZChnYW1lU2NlbmUpXG5cblxuICAgIGxldCB0ZXh0ID0gbmV3IFBJWEkuVGV4dChcImFkZFwiLCB7Zm9udFNpemU6IDIwLCBmaWxsOiBcIndoaXRlXCJ9KVxuICAgIHRleHQucG9zaXRpb24uc2V0KHN5c3NpemVbMV0qZGVsdGEsMTAwKVxuICAgIGdhbWVTY2VuZS5hZGRDaGlsZCh0ZXh0KTtcblxuICAgIGxldCBiX2FkZCA9IG5ldyBQSVhJLlNwcml0ZShQSVhJLlRleHR1cmUuV0hJVEUpXG4gICAgYl9hZGQuaW50ZXJhY3RpdmUgPSB0cnVlXG4gICAgYl9hZGQuYnV0dG9uTW9kZT10cnVlXG4gICAgYl9hZGQud2lkdGggPSBidXR0b25TaXplXG4gICAgYl9hZGQuaGVpZ2h0PSBidXR0b25TaXplXG4gICAgYl9hZGQudGludCA9IDB4MDAwMEZGXG4gICAgYl9hZGQucG9zaXRpb24uc2V0KHN5c3NpemVbMV0qZGVsdGEsIDApXG4gICAgYXBwLnN0YWdlLmFkZENoaWxkKGJfYWRkKTtcbiAgICBsZXQgYl9hZGRfdGV4dCA9IG5ldyBQSVhJLlRleHQoXCJXYXRlclwiLCB7Zm9udFNpemU6IGRlbHRhKjEuNSwgZmlsbDogXCJ3aGl0ZVwifSlcbiAgICBiX2FkZF90ZXh0LnBvc2l0aW9uLnNldChiX2FkZC5wb3NpdGlvbi54LCBiX2FkZC5wb3NpdGlvbi55K2J1dHRvblNpemUrMTApXG4gICAgYXBwLnN0YWdlLmFkZENoaWxkKGJfYWRkX3RleHQpXG5cbiAgICAgbGV0IGJfYmxvY2sgPSBuZXcgUElYSS5TcHJpdGUoUElYSS5UZXh0dXJlLldISVRFKVxuICAgICBiX2Jsb2NrLmludGVyYWN0aXZlID0gdHJ1ZVxuICAgICBiX2Jsb2NrLmJ1dHRvbk1vZGU9dHJ1ZVxuICAgICBiX2Jsb2NrLndpZHRoID0gYnV0dG9uU2l6ZVxuICAgICBiX2Jsb2NrLmhlaWdodD0gYnV0dG9uU2l6ZVxuICAgICBiX2Jsb2NrLnRpbnQgPSAweEZGRkZGRlxuICAgICBiX2Jsb2NrLnBvc2l0aW9uLnNldCgoc3lzc2l6ZVsxXSsyKSpkZWx0YStidXR0b25TaXplLCAwKVxuICAgICBhcHAuc3RhZ2UuYWRkQ2hpbGQoYl9ibG9jayk7XG4gICAgIGxldCBiX2Jsb2NrX3RleHQgPSBuZXcgUElYSS5UZXh0KFwiQmxvY2tcIiwge2ZvbnRTaXplOiBkZWx0YSoxLjUsIGZpbGw6IFwid2hpdGVcIn0pXG4gICAgIGJfYmxvY2tfdGV4dC5wb3NpdGlvbi5zZXQoYl9ibG9jay5wb3NpdGlvbi54LCBiX2Jsb2NrLnBvc2l0aW9uLnkrYnV0dG9uU2l6ZSsxMClcbiAgICAgYXBwLnN0YWdlLmFkZENoaWxkKGJfYmxvY2tfdGV4dClcblxuICAgICBsZXQgYl9kZWxldGUgPSBuZXcgUElYSS5TcHJpdGUoUElYSS5UZXh0dXJlLldISVRFKVxuICAgICBiX2RlbGV0ZS5pbnRlcmFjdGl2ZSA9IHRydWVcbiAgICAgYl9kZWxldGUuYnV0dG9uTW9kZT10cnVlXG4gICAgIGJfZGVsZXRlLndpZHRoID0gYnV0dG9uU2l6ZVxuICAgICBiX2RlbGV0ZS5oZWlnaHQ9IGJ1dHRvblNpemVcbiAgICAgYl9kZWxldGUudGludCA9IDB4OTk5OTk5XG4gICAgIGJfZGVsZXRlLnBvc2l0aW9uLnNldCgoc3lzc2l6ZVsxXSs0KSpkZWx0YSsyKmJ1dHRvblNpemUsIDApXG4gICAgIGFwcC5zdGFnZS5hZGRDaGlsZChiX2RlbGV0ZSk7XG4gICAgIGxldCBiX2RlbGV0ZV90ZXh0ID0gbmV3IFBJWEkuVGV4dChcIkRlbGV0ZVwiLCB7Zm9udFNpemU6IGRlbHRhKjEuNSwgZmlsbDogXCJ3aGl0ZVwifSlcbiAgICAgYl9kZWxldGVfdGV4dC5wb3NpdGlvbi5zZXQoYl9kZWxldGUucG9zaXRpb24ueCwgYl9kZWxldGUucG9zaXRpb24ueStidXR0b25TaXplKzEwKVxuICAgICBhcHAuc3RhZ2UuYWRkQ2hpbGQoYl9kZWxldGVfdGV4dCk7XG5cbiAgICAoKCk9PntcbiAgICAgICAgbGV0IGlzVG91Y2hlZCA9IGZhbHNlXG4gICAgICAgIGxldCBjbGlja19mdW5jID0gKCk9Pnt9XG5cbiAgICAgICAgYl9hZGQub24oXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUgOiBQSVhJLmludGVyYWN0aW9uLkludGVyYWN0aW9uRXZlbnQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGlubmVyV2lkdGgsIGlubmVySGVpZ2h0KVxuICAgICAgICAgICAgY2xpY2tfZnVuYyA9IGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsZXQgY1xuICAgICAgICAgICAgICAgIGlmIChpc1RvdWNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBlLmRhdGEuZ2V0TG9jYWxQb3NpdGlvbihnYW1lU2NlbmUpXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAtMTsgaSA8PSAxOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAtMTsgaiA8PSAxOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gY2VsbHMuZ2V0KFtNYXRoLmZsb29yKHAueS9kZWx0YSkraSwgTWF0aC5mbG9vcihwLngvZGVsdGEpK2pdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5hZGRtYXNzKDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIGJfYmxvY2sub24oXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUgOiBQSVhJLmludGVyYWN0aW9uLkludGVyYWN0aW9uRXZlbnQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiaGVsbG9cIilcbiAgICAgICAgICAgIGNsaWNrX2Z1bmMgPSBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKGlzVG91Y2hlZCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcCA9IGUuZGF0YS5nZXRMb2NhbFBvc2l0aW9uKGdhbWVTY2VuZSlcbiAgICAgICAgICAgICAgICAgICAgbGV0IGkgPSBNYXRoLmZsb29yKHAueS9kZWx0YSlcbiAgICAgICAgICAgICAgICAgICAgbGV0IGogPSAgTWF0aC5mbG9vcihwLngvZGVsdGEpXG4gICAgICAgICAgICAgICAgICAgIGxldCBjID0gY2VsbHMuZ2V0KFtpLCBqXSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHMuc2V0KFtpLCBqXSwgbmV3IEdyb3VuZCgpKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIGJfZGVsZXRlLm9uKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlIDogUElYSS5pbnRlcmFjdGlvbi5JbnRlcmFjdGlvbkV2ZW50KSB7XG4gICAgICAgICAgICBjbGlja19mdW5jID0gZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmIChpc1RvdWNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBlLmRhdGEuZ2V0TG9jYWxQb3NpdGlvbihnYW1lU2NlbmUpXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAtMTsgaSA8PSAxOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAtMTsgaiA8PSAxOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IE1hdGguZmxvb3IocC55L2RlbHRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqID0gIE1hdGguZmxvb3IocC54L2RlbHRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjID0gY2VsbHMuZ2V0KFtpLCBqXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxzLnNldChbaSxqXSwgbmV3IFdhdGVyKDApKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBnYW1lU2NlbmUub24oXCJtb3VzZWRvd25cIixcbiAgICAgICAgICAgIGZ1bmN0aW9uKGV2ZW50IDogUElYSS5pbnRlcmFjdGlvbi5JbnRlcmFjdGlvbkV2ZW50KVxuICAgICAgICAgICAgeyAgXG4gICAgICAgICAgICAgICAgaXNUb3VjaGVkID0gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICApXG5cbiAgICAgICAgZ2FtZVNjZW5lLm9uKFwibW91c2V1cFwiLFxuICAgICAgICAgICAgZnVuY3Rpb24oZXZlbnQgOiBQSVhJLmludGVyYWN0aW9uLkludGVyYWN0aW9uRXZlbnQpXG4gICAgICAgICAgICB7ICBcbiAgICAgICAgICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIGdhbWVTY2VuZS5vbihcIm1vdXNlbW92ZVwiLFxuICAgICAgICAgICAgZnVuY3Rpb24oZXZlbnQgOiBQSVhJLmludGVyYWN0aW9uLkludGVyYWN0aW9uRXZlbnQpXG4gICAgICAgICAgICB7ICBcbiAgICAgICAgICAgICAgICBjbGlja19mdW5jKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuXG5cblxuICAgIH0pKCk7XG5cblxuICAgIGxldCBzcHJpdGVfbWF0ID0gbmV3IEFycmF5KHN5c3NpemVbMF0pXG4gICAgZm9yIChsZXQgaT0wOyBpPHN5c3NpemVbMF07IGkrKylcbiAgICB7XG4gICAgICAgIHNwcml0ZV9tYXRbaV0gPSBuZXcgQXJyYXkoc3lzc2l6ZVsxXSlcbiAgICAgICAgZm9yIChsZXQgaj0wOyBqPHN5c3NpemVbMV07IGorKylcbiAgICAgICAge1xuICAgICAgICAgICAgc3ByaXRlX21hdFtpXVtqXSA9IG5ldyBQSVhJLlNwcml0ZShQSVhJLlRleHR1cmUuV0hJVEUpXG4gICAgICAgICAgICBzcHJpdGVfbWF0W2ldW2pdLndpZHRoID1kZWx0YSBcbiAgICAgICAgICAgIHNwcml0ZV9tYXRbaV1bal0uaGVpZ2h0ID0gZGVsdGFcbiAgICAgICAgICAgIHNwcml0ZV9tYXRbaV1bal0ucG9zaXRpb24uc2V0KGoqZGVsdGEsIGkqZGVsdGEpXG4gICAgICAgICAgICBnYW1lU2NlbmUuYWRkQ2hpbGQoc3ByaXRlX21hdFtpXVtqXSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdhbWVTY2VuZS5pbnRlcmFjdGl2ZSA9IHRydWVcbiAgICBnYW1lU2NlbmUuYnV0dG9uTW9kZT10cnVlXG4gICAgbGV0IHJlY3QgPSBuZXcgUElYSS5HcmFwaGljcygpXG4gICAgZ2FtZVNjZW5lLmFkZENoaWxkKHJlY3QpXG5cbiAgICBsZXQgdGltZSA9IDBcblxuICAgIGZ1bmN0aW9uIGNlbGxfdXBkYXRlX2Z1bmMoZGVsdGEgOiBudW1iZXIpIHtcbiAgICAgICAgdGltZSArPSBkZWx0YVxuICAgICAgICB0ZXh0LnRleHQgPSBTdHJpbmcoYXBwLnRpY2tlci5GUFMpXG4gICAgICAgIGNlbGxzLnVwZGF0ZSgxKVxuXG4gICAgICAgIGlmICh0aW1lID4gMCkge1xuICAgICAgICAgICAgZHJhd19jZWxsc19zcHJpdGUoY2VsbHMsIHNwcml0ZV9tYXQpXG4gICAgICAgICAgICB0aW1lID0gMFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXBwLnRpY2tlci5hZGQoXG4gICAgICAgIGNlbGxfdXBkYXRlX2Z1bmNcbiAgICApXG59XG5cbnNldHVwKClcblxuXG5cbi8vQWRkIHRoZSBjYW52YXMgdGhhdCBQaXhpIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBmb3IgeW91IHRvIHRoZSBIVE1MIGRvY3VtZW50XG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGFwcC52aWV3KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=